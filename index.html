<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private Tracker</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #fff; margin:0; padding:0; }
  .container { max-width:800px; margin:20px auto; padding:10px; }
  h1 { text-align:center; color:#00AAFF; }
  .step { margin:15px 0; padding:10px; border-radius:8px; background:#222; display:flex; align-items:center; justify-content:space-between; }
  .step.completed { background:#0033FF; }
  .step button { padding:6px 10px; border:none; border-radius:5px; cursor:pointer; background:#00AAFF; color:#fff; }
  .progress-container { width:100%; background:#333; border-radius:10px; height:20px; margin:20px 0; }
  .progress-bar { height:100%; width:0%; background:#00AAFF; border-radius:10px; transition:width 0.5s; }
  .milestone-msg { font-size:0.9em; color:#0f0; margin-top:5px; }
</style>
</head>
<body>
<div class="container">
  <h1>Private Kuwait Job Tracker</h1>

  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
  </div>

  <!-- Steps -->
  <div id="steps-container"></div>

  <!-- Chat -->
  <div id="chat-container" style="position:fixed;bottom:0;right:0;width:100%;max-width:400px;background:#1a1a1a;padding:10px;border-top:3px solid #00AAFF;box-shadow:0 -2px 5px rgba(0,0,0,0.5);">
    <div id="chat-messages" style="height:200px;overflow-y:auto;margin-bottom:10px;border:1px solid #555;padding:10px;border-radius:8px;background:#000;display:flex;flex-direction:column;"></div>
    <input type="text" id="chat-input" placeholder="Type a message..." style="width:75%;padding:8px;border-radius:5px;border:none;margin-right:5px;">
    <button id="chat-send" style="padding:8px 12px;border:none;border-radius:5px;background:#00AAFF;color:#fff;cursor:pointer;">Send</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAeaNbgbfnOX5i3B3TIlZ7uwLXK86dOOgo",
    authDomain: "private-tracker-85553.firebaseapp.com",
    projectId: "private-tracker-85553",
    storageBucket: "private-tracker-85553.firebasestorage.app",
    messagingSenderId: "542425150653",
    appId: "1:542425150653:web:76a2065694dfb155ca73d4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Steps Data
  const steps = [
    { name:"Prometric exam (MOH Kuwait)", msg:"Prometric exam complete! Keep going ðŸ’ª" },
    { name:"Documents attestation", msg:"Documents attested! Great job ðŸ“„" },
    { name:"Documents verification (QuadraBay)", msg:"Verification done! Almost there âœ…" },
    { name:"Job offer", msg:"Job offer received! Woohoo ðŸŽ‰" },
    { name:"Receive Visa", msg:"Visa received! ðŸ›‚" },
    { name:"Visa Stamping", msg:"Visa stamped! âœˆï¸" },
    { name:"Medical Test (Fit)", msg:"Medical test passed! ðŸ’Š" },
    { name:"Travel", msg:"Travel complete! Surprise incoming ðŸŽ" }
  ];

  const stepsContainer = document.getElementById('steps-container');
  const progressBar = document.getElementById('progress-bar');

  // Initialize Steps
  steps.forEach((step, index) => {
    const div = document.createElement('div');
    div.className = 'step';
    div.id = 'step-'+index;
    div.innerHTML = `<span>${step.name}</span> <button>Done</button><div class="milestone-msg" id="msg-${index}"></div>`;
    stepsContainer.appendChild(div);

    const btn = div.querySelector('button');
    btn.addEventListener('click', () => completeStep(index));
  });

  let completedSteps = 0;
  function completeStep(i){
    const div = document.getElementById('step-'+i);
    div.classList.add('completed');
    div.querySelector('button').disabled = true;
    document.getElementById('msg-'+i).textContent = steps[i].msg;

    completedSteps++;
    progressBar.style.width = ((completedSteps/steps.length)*100)+'%';

    if(i === steps.length-1){
      setTimeout(() => { alert("ðŸŽ Surprise! All steps completed!"); }, 500);
    }
  }

  // Chat Logic
  const chatInput = document.getElementById('chat-input');
  const chatSend = document.getElementById('chat-send');
  const chatMessages = document.getElementById('chat-messages');

  onChildAdded(ref(db,'messages'), (snapshot)=>{
    const msg = snapshot.val();
    addMessage(atob(msg.text), msg.user);
  });

  chatSend.addEventListener('click', ()=>{
    const text = chatInput.value.trim();
    if(!text) return;
    const encrypted = btoa(text);
    push(ref(db,'messages'), { text: encrypted, user:'you' });
    chatInput.value = '';
  });

  function addMessage(text, user){
    const msg = document.createElement('div');
    msg.textContent = text;
    msg.style.margin = '5px 0';
    msg.style.padding = '6px 10px';
    msg.style.borderRadius = '10px';
    msg.style.maxWidth = '80%';
    msg.style.wordBreak = 'break-word';
    msg.style.background = user==='you' ? '#00AAFF' : '#AA00FF';
    msg.style.color = user==='you' ? '#000' : '#fff';
    msg.style.alignSelf = user==='you' ? 'flex-end' : 'flex-start';
    chatMessages.appendChild(msg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
</script>
