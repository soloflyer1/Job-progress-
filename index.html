<!-- Chat Box HTML -->
<div id="chat-box" style="position: fixed; bottom: 20px; right: 20px; width: 300px; height: 400px; background: #f0f4f8; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); display: flex; flex-direction: column;">
  <div id="messages" style="flex: 1; overflow-y: auto; padding: 10px;"></div>
  <input type="text" id="messageInput" placeholder="Type a message..." style="padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: calc(100% - 20px); margin: 10px;">
  <button id="sendBtn" style="margin: 0 10px 10px 10px; padding: 8px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Send</button>
  <button id="clearBtn" style="margin: 0 10px 10px 10px; padding: 8px; background-color: red; color: white; border: none; border-radius: 5px; cursor: pointer;">Clear Chat</button>
</div>

<!-- Firebase Scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAeaNbgbfnOX5i3B3TIlZ7uwLXK86dOOgo",
    authDomain: "private-tracker-85553.firebaseapp.com",
    projectId: "private-tracker-85553",
    storageBucket: "private-tracker-85553.firebasestorage.app",
    messagingSenderId: "542425150653",
    appId: "1:542425150653:web:76a2065694dfb155ca73d4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, 'messages');

  const messagesDiv = document.getElementById('messages');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');
  const clearBtn = document.getElementById('clearBtn');

  // Send message
  sendBtn.addEventListener('click', () => {
    const text = messageInput.value.trim();
    if(text !== "") {
      push(messagesRef, { text });
      messageInput.value = "";
    }
  });

  // Listen for new messages
  onChildAdded(messagesRef, (data) => {
    const msg = document.createElement('div');
    msg.textContent = data.val().text;
    msg.style.padding = "5px";
    msg.style.marginBottom = "5px";
    msg.style.background = "#d1e7ff";
    msg.style.borderRadius = "5px";
    messagesDiv.appendChild(msg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });

  // Clear all messages (delete from Firebase)
  clearBtn.addEventListener('click', () => {
    remove(messagesRef);
    messagesDiv.innerHTML = ""; // clear local view instantly
  });
</script>
